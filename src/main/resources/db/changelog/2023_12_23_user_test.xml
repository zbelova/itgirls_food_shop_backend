<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd">


    <changeSet id="alter-table-user-role" author="Mariia_Buruk">
        <sql>
            ALTER TABLE IF EXISTS "user_role" DROP CONSTRAINT IF EXISTS user_role_role_id_key;
            ALTER TABLE IF EXISTS "user_role" DROP CONSTRAINT IF EXISTS user_role_user_id_key;
        </sql>
    </changeSet>

    <changeSet id="insert-user-into-roles" author="Mariia_Buruk">
        <sql>
            INSERT INTO "user"("id","name", email, phone, address, password) values
            (uuid_generate_v4(),
            'UserTest',
            'user@mail.ru',
            '',
            '',
            '$2a$10$rmgvdWGhGiTVKM3JFPcKTeWnEqWChofrC6aCNtW5fFu9alMEKxToa'
            );

            INSERT INTO user_role (user_id, role_id)
            Select
            (select "user".id from "user" where "user".email = 'user@mail.ru'),
            (select "role".id from "role" where "role".name = 'ROLE_USER');
        </sql>
    </changeSet>

</databaseChangeLog>
